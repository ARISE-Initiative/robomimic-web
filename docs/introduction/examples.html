

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Working with robomimic Modules &mdash; robomimic 0.2.0 documentation</title>
  

  
  <link rel="stylesheet" href="../static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../static/documentation_options.js"></script>
        <script src="../static/jquery.js"></script>
        <script src="../static/underscore.js"></script>
        <script src="../static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Using Demonstration Datasets" href="datasets.html" />
    <link rel="prev" title="Advanced Features" href="advanced.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> robomimic
          

          
          </a>

          
            
            
              <div class="version">
                0.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Introduction</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Features Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="advanced.html">Advanced Features</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Working with robomimic Modules</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#train-loop-example">Train Loop Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#config-example">Config Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#observation-networks-example">Observation Networks Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-observation-modalities-example">Custom Observation Modalities Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="datasets.html">Using Demonstration Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_zoo.html">Using the Model Zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="results.html">Reproducing Study Results</a></li>
</ul>
<p class="caption"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/dataset.html">SequenceDataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/observations.html">Observations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/algorithms.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/configs.html">Configs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/environments.html">Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/utils.html">Utils</a></li>
</ul>
<p class="caption"><span class="caption-text">Source API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/robomimic.html">robomimic package</a></li>
</ul>
<p class="caption"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../miscellaneous/troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../miscellaneous/contributing.html">Contributing Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../miscellaneous/team.html">Team</a></li>
<li class="toctree-l1"><a class="reference internal" href="../miscellaneous/acknowledgments.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../miscellaneous/references.html">Projects using robomimic</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">robomimic</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Working with robomimic Modules</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../sources/introduction/examples.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="working-with-robomimic-modules">
<h1>Working with robomimic Modules<a class="headerlink" href="#working-with-robomimic-modules" title="Permalink to this headline">¶</a></h1>
<p>This section discusses some simple examples packaged with the repository (in the top-level <code class="docutils literal notranslate"><span class="pre">examples</span></code> folder) that provide a more thorough understanding of components used in the repository. These examples are meant to assist users who may want to build on these components, or use these components in other applications, in contrast to the <a class="reference external" href="./quickstart.html">Getting Started</a> section, which provides examples relevant to using the repository as-is.</p>
<div class="section" id="train-loop-example">
<h2>Train Loop Example<a class="headerlink" href="#train-loop-example" title="Permalink to this headline">¶</a></h2>
<p>We include a simple example script in <code class="docutils literal notranslate"><span class="pre">examples/simple_train_loop.py</span></code> to show how easy it is to use our <code class="docutils literal notranslate"><span class="pre">SequenceDataset</span></code> class and standardized hdf5 datasets in a general torch training loop. Run the example using the command below.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ python examples/simple_train_loop.py
</pre></div>
</div>
<p>Modifying this example for use in other code repositories is simple. First, create the dataset loader as in the script.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">robomimic.utils.dataset</span> <span class="kn">import</span> <span class="n">SequenceDataset</span>

<span class="k">def</span> <span class="nf">get_data_loader</span><span class="p">(</span><span class="n">dataset_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a data loader to sample batches of data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">SequenceDataset</span><span class="p">(</span>
        <span class="n">hdf5_path</span><span class="o">=</span><span class="n">dataset_path</span><span class="p">,</span>
        <span class="n">obs_keys</span><span class="o">=</span><span class="p">(</span>                      <span class="c1"># observations we want to appear in batches</span>
            <span class="s2">&quot;robot0_eef_pos&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;robot0_eef_quat&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;robot0_gripper_qpos&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;object&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">dataset_keys</span><span class="o">=</span><span class="p">(</span>                  <span class="c1"># can optionally specify more keys here if they should appear in batches</span>
            <span class="s2">&quot;actions&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;rewards&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;dones&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">load_next_obs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">frame_stack</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">seq_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>                  <span class="c1"># length-10 temporal sequences</span>
        <span class="n">pad_frame_stack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">pad_seq_length</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>            <span class="c1"># pad last obs per trajectory to ensure all sequences are sampled</span>
        <span class="n">get_pad_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">goal_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">hdf5_cache_mode</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>          <span class="c1"># cache dataset in memory to avoid repeated file i/o</span>
        <span class="n">hdf5_use_swmr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">hdf5_normalize_obs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">filter_by_attribute</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>       <span class="c1"># can optionally provide a filter key here</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">============= Created Dataset =============&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">data_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span>
        <span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span>
        <span class="n">sampler</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>       <span class="c1"># no custom sampling logic (uniform sampling)</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>     <span class="c1"># batches of size 100</span>
        <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">drop_last</span><span class="o">=</span><span class="kc">True</span>      <span class="c1"># don&#39;t provide last batch in dataset pass if it&#39;s less than 100 in size</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">data_loader</span>

<span class="n">data_loader</span> <span class="o">=</span> <span class="n">get_data_loader</span><span class="p">(</span><span class="n">dataset_path</span><span class="o">=</span><span class="s2">&quot;/path/to/your/dataset.hdf5&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then, construct your model, and use the same pattern as in the <code class="docutils literal notranslate"><span class="pre">run_train_loop</span></code> function in the script, to iterate over batches to train the model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_epochs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
  
    <span class="c1"># iterator for data_loader - it yields batches</span>
    <span class="n">data_loader_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">data_loader</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">train_step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gradient_steps_per_epoch</span><span class="p">):</span>
        <span class="c1"># load next batch from data loader</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">batch</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">data_loader_iter</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="c1"># data loader ran out of batches - reset and yield first batch</span>
            <span class="n">data_loader_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">data_loader</span><span class="p">)</span>
            <span class="n">batch</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">data_loader_iter</span><span class="p">)</span>

        <span class="c1"># @batch is a dictionary with keys loaded from the dataset.</span>
        <span class="c1"># Train your model on the batch below.</span>
    
</pre></div>
</div>
</div>
<div class="section" id="config-example">
<h2>Config Example<a class="headerlink" href="#config-example" title="Permalink to this headline">¶</a></h2>
<p>The simple config example script at <code class="docutils literal notranslate"><span class="pre">examples/simple_config.py</span></code> shows how the <code class="docutils literal notranslate"><span class="pre">Config</span></code> object can easily be instantiated and modified safely with different levels of locking. We reproduce certain portions of the script. First, we can create a <code class="docutils literal notranslate"><span class="pre">Config</span></code> object and call <code class="docutils literal notranslate"><span class="pre">lock</span></code> when we think we won’t need to change it anymore.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">robomimic.config.base_config</span> <span class="kn">import</span> <span class="n">Config</span>

<span class="c1"># create config</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">()</span>

<span class="c1"># add nested attributes to the config</span>
<span class="n">config</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">config</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">1e-3</span>
<span class="n">config</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">actor_network_size</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
<span class="n">config</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>  <span class="c1"># prevent accidental changes</span>
</pre></div>
</div>
<p>Now, when we try to add a new key (or modify the value of an existing key), the config will throw an error.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># the config is locked --- cannot add new keys or modify existing keys</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">config</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="s2">&quot;Adam&quot;</span>
<span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
<p>However, the config can be safely modified using appropriate contexts.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># values_unlocked scope allows modifying values of existing keys, but not adding keys</span>
<span class="k">with</span> <span class="n">config</span><span class="o">.</span><span class="n">values_unlocked</span><span class="p">():</span>
    <span class="n">config</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">200</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;batch_size=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">batch_size</span><span class="p">))</span>

<span class="c1"># unlock config within the scope, allowing new keys to be inserted</span>
<span class="k">with</span> <span class="n">config</span><span class="o">.</span><span class="n">unlocked</span><span class="p">():</span>
    <span class="n">config</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">num_eval</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># verify that the config remains locked outside of the scope</span>
<span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">is_locked</span>
<span class="k">assert</span> <span class="n">config</span><span class="o">.</span><span class="n">test</span><span class="o">.</span><span class="n">is_locked</span>
</pre></div>
</div>
<p>Finally, the config can also be updated by using external dictionaries - this is helpful for loading config jsons.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># update this config with external config from a dict</span>
<span class="n">ext_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;learning_rate&quot;</span><span class="p">:</span> <span class="mf">1e-3</span>
    <span class="p">},</span>
    <span class="s2">&quot;algo&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;actor_network_size&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">with</span> <span class="n">config</span><span class="o">.</span><span class="n">values_unlocked</span><span class="p">():</span>
    <span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ext_config</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</pre></div>
</div>
<p>Please see the <a class="reference external" href="../modules/configs.html">Config documentation</a> for more information on Config objects.</p>
</div>
<div class="section" id="observation-networks-example">
<h2>Observation Networks Example<a class="headerlink" href="#observation-networks-example" title="Permalink to this headline">¶</a></h2>
<p>The example script in <code class="docutils literal notranslate"><span class="pre">examples/simple_obs_net.py</span></code> discusses how to construct networks for taking observation dictionaries as input, and that produce dictionaries as outputs. See <a class="reference external" href="../modules/models.html#observation-encoder-and-decoder">this section</a> in the documentation for more details.</p>
</div>
<div class="section" id="custom-observation-modalities-example">
<h2>Custom Observation Modalities Example<a class="headerlink" href="#custom-observation-modalities-example" title="Permalink to this headline">¶</a></h2>
<p>The example script in <code class="docutils literal notranslate"><span class="pre">examples/add_new_modality.py</span></code> discusses how to (a) modify pre-existing observation modalities, and (b) add your own custom observation modalities with custom encoding. See <a class="reference external" href="../modules/models.html#observation-encoder-and-decoder">this section</a> in the documentation for more details about the encoding and decoding process.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="datasets.html" class="btn btn-neutral float-right" title="Using Demonstration Datasets" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="advanced.html" class="btn btn-neutral float-left" title="Advanced Features" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Ajay Mandlekar, Danfei Xu, Josiah Wong, Soroush Nasiriany, Chen Wang.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>